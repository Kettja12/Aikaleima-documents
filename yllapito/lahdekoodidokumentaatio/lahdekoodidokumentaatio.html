<html>
<head>
    <meta charset="UTF-8">
    <title>Lähdekoodidokumentaatio</title>

    <link rel="stylesheet" href="/css/app.css">
    <link rel="stylesheet" href="/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/prism.css">

    <script src="/js/popper.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/prism.js" data-manual></script>
    <script src="/js/prism-file-highlight.js"></script>

    <link rel="stylesheet" href="lahdekoodidokumentaatio.css">

</head>
<body>
<h2>Lähdekoodidokumentaatio</h2>
<div class="alert alert-info" role="alert">
  <strong>Huom!</strong> Tämän dokumentaation kuvaama lähdekoodi ei ole julkisesti saatavilla. Pääset tutustumaan siihen ottamalla yhteyttä projektin omistajaan <a href="https://github.com/Kettja12" target="_blank" rel="noopener noreferrer" class="alert-link">GitHub-profiilin</a> kautta.
</div>
<p>
	Tämän dokumentaation painopiste on lähdekoodissa. Mikäli <a href="https://dotnet.microsoft.com/en-us/apps/aspnet/web-apps/blazor">Blazor</a> ei ole tuttu, paras tietolähde sen kotisivujen jälkeen on YouTube.
	Paras ohjelmointiympäristö on mielestäni ilmainen <a href="https://visualstudio.microsoft.com/vs/community/">Visual Studio Community</a>,
	ei ainoastaan Blazor-sovellusten, vaan yleisemminkin <a href="https://dotnet.microsoft.com/en-us/">.NET</a>-sovellusten rakentamiseen.
</p>
<p>
    Sovelluksen suunnittelumalli on modulaarinen monoliitti. Jos termi ei ole tuttu, kyseessä on arkkitehtuurimalli, jossa sovellus on jaettu useisiin itsenäisiin moduuleihin, mutta kaikki moduulit toimivat yhdessä yhtenä kokonaisuutena.
    Tämä malli tarjoaa etuja, kuten helpomman ylläpidon ja kehityksen, koska moduulit voidaan kehittää ja testata erikseen, mutta ne jakavat saman sovellusympäristön.
    Mitä se sitten tarkoittaa? Se tarkoittaa, että sovelluksen eri osat on jaettu selkeisiin osioihin, joita kutsutaan myös moduuleiksi, ja jotka käännetään yhdeksi kokonaisuudeksi. Ohjelmistokehityksen trendit ovat viime vuosina suosineet mikropalveluarkkitehtuuria, jossa sovellus jaetaan pieniin, itsenäisiin palveluihin.
    Modulaarinen monoliitti tarjoaa kuitenkin tasapainon monoliittisen ja mikropalveluarkkitehtuurin välillä, jolloin kehittäjät voivat hyödyntää molempien mallien etuja.
</p>

<div class="diagram-container">
    <div class="client-column">
        <div class="diagram-outer-box">
            <div class="label">Selain ja verkkosivu</div>
            <div class="diagram-box">
                Käyttöliittymä
            </div>
        </div>
        <div class="diagram-box" style="width: 200px; margin-top: 50px;">
            Android/Windows client
        </div>
    </div>

    <div class="diagram-outer-box" style="width: 420px; min-height: 240px;">
        <div class="label">Palvelin</div>
        <div class="inner-flex-container">
            <div class="diagram-box" style="width: 200px; min-height: 200px;">
                Blazor server prosessi
            </div>
            <div class="diagram-box">
                Tietokanta
            </div>
        </div>
    </div>
    <div class="arrow-connector">
        <div class="arrow-label-right">click, jne...</div>
        <div class="arrow-label-left">DOM-päivitykset</div>
        <div class="arrow-text">SignalR</div>
        <div class="arrow right"></div>
        <div class="arrow left"></div>
    </div>
    <div class="api-arrow-connector">
        <div class="api-arrow-text">api-rajapinta</div>
        <div class="api-arrow right"></div>
        <div class="api-arrow left"></div>
    </div>

</div>
<article>
    <h2>Sovelluksen rakenne</h2>
    <p style="overflow: auto;">
      <img src="projektinrakenne.png" alt="Projektinrakenne" width="200" style="float: left; margin-right: 15px; margin-bottom: 5px;" />
          Lähdekoodissa sovellus koostuu seuraavista moduuleista.
    </p>
    <h3>Repository</h3>
    <p>
        <a href="repository/repository.html" 
        class="btn btn-outline-secondary btn-sm"  rel="noopener noreferrer">Repository-dll</a>
       -moduuli, joka hoitaa tietokantaoperaatiot.
        Repository-moduulin rajapinta koostuu kolmesta osasta: pyynnöistä (request), vastauksista (response) ja palveluista (services).
        Repositoryn `Services`-luokka toteuttaa kaikki palvelut, ja sen metodeja kutsutaan muualta koodista.
        Palvelut ovat funktioita, jotka suorittavat tietyn toiminnon. `Request`-parametrilla kerrotaan toiminnolle tarvittavat tiedot, ja `Response` palauttaa toiminnon tuloksen.
    </p>
    <h3>Shared</h3>
    <p>
        <a href="https://github.com/Kettja12/Aikaleima-shared/blob/b650db784dda40da381789b9dd7168979a775336/Shared.csproj?plain=1" 
        class="btn btn-outline-secondary btn-sm" target="_blank" rel="noopener noreferrer">Shared-dll</a>
        -moduuli, joka sisältää jaetut luokat, kuten API-rajapinnan kutsut,request ja response-rakenteet.
    </p>

    <h3>Käyttöliitymä komponentit</h3>
    <p>
        <a href="kayttoliittymakomponentit/kayttoliittymakomponentit.html" class="btn btn-outline-secondary">käyttöliittymä komponentit</a>
        löytyvät lähdekoodista 'Components'-kansiosta, 
    </p>
    <h3>Domain</h3>
    <p>
        <a href="domain/domain.html" class="btn btn-outline-secondary">Domainkomponentit</a>
        Komponentit löytyvät lähdekoodista 'Domain'-kansiosta, 
    </p>
        
    </p>
    <h3>Sovellus ydintoiminnot</h3>
    <p>
        Ydintoiminnot hoitavat sovelluksen käynnistyksen, konfiguroinnin ja HTTP-pyyntöjen käsittelyn.
        Ne vastaavat myös palveluista, eri näkymien renderöinnistä ja käyttäjän syötteiden välittämisestä käyttöliittymäkomponenteille.
        <a href="https://github.com/Kettja12/aikajana-ssr/blob/e072c1b609c987aa242d944edb39cef923bf0fcd/Program.cs?plain=1#L5C1-L5C50" class="btn btn-outline-secondary btn-sm" target="_blank" rel="noopener noreferrer">Program.cs</a>
 
        <pre data-src="Program.cs" class="language-csharp"></pre>

    </p>
    <h3>BackgroundServices</h3>
    <p>
        <a href="https://github.com/Kettja12/aikajana-ssr/blob/298c7392f5d3cb372629668ab8d918f3e052b0f5/BackgroundServices/?plain=1" 
        class="btn btn-outline-secondary btn-sm" target="_blank" rel="noopener noreferrer">BackgroundServices</a>
        Tällä hetkellä sovelluksessa on yksi taustatoiminto joka tallentaa laimaustapahtumat tietokantaan. Lyhyesti selostettuna. Leimauksen tallennus apikutsu vie tapahtuman cacheen.
        Taustaprosessi tallentaa cachen 30 sekunnin välein. Miksi tämä ratkaisu. Testiohjelmalla (joka löytyy asiaskasjärjestelmä koodeista). 
        Tehtyjen testien perusteella esim 100 asiakas-clientilla 100 leimausta sekuntin välein eli 100 leimausta sekunnissa. Aiheutti satunnaisia lukitus vireitä kantatiedostoon. 
    </p>

    <h3>API</h3>
    <p>
        <a href="https://github.com/Kettja12/aikajana-ssr/blob/e072c1b609c987aa242d944edb39cef923bf0fcd/API/Routes.cs?plain=1" 
        class="btn btn-outline-secondary btn-sm" target="_blank" rel="noopener noreferrer">routes.cs</a>
        API-osio sisältää reititysmääritykset, jotka alustetaan sovelluksen käynnistyessä. Nämä reitit palvelevat kaikkia API-asiakkaita.
        Järjestelmässä käytetään post-metodeja myös dataa haettaessa, koska halutaan pitää hakuparametrit contentissa eikä urlissa.
        Mikäli hakuparameterja ei ole niin silloin käy ihan hyvin get-metodi. 
    <pre data-src="Routes.cs" class="language-csharp"></pre>
    </p>

</article>
<script>
         window.onload = function() {
            // Haetaan kaikki kuvat, jotka ovat <article>-elementtien sisällä
            const images = document.querySelectorAll('article img');

            // Lisätään jokaiseen kuvaan tapahtumankäsittelijät
            images.forEach(img => {
                const originalWidth = img.width; // Tallennetaan alkuperäinen leveys

                img.addEventListener('mouseover', () => {
                    img.style.width = '600px'; // Muutetaan leveys 600px, kun hiiri on päällä
                });
                img.addEventListener('mouseout', () => {
                    img.style.width = originalWidth + 'px'; // Palautetaan alkuperäinen leveys, kun hiiri poistuu
                });
            });
        }
    
</script>

</body>
</html>